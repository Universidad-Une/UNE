---
// Layout principal de la aplicación con valores por defecto
import Header from "../components/layout/Header.astro";
import Footer from "../components/layout/Footer.astro";
import "../styles/global.css";
import Clarity from "../components/layout/Clarity.astro";

// Configuración por defecto
const defaultConfig = {
  projectId: "spfe9hsbw6",
  title: "UNE - Universidad de Especialidades",
  description: "Universidad UNE - 30 años creyendo en ti. Licenciaturas, posgrados y educación continua en línea y presencial.",
  lang: "es",
  charset: "UTF-8"
};

// Extraer props con valores por defecto
const { 
  title = defaultConfig.title,
  description = defaultConfig.description,
  lang = defaultConfig.lang,
  charset = defaultConfig.charset,
  projectId = defaultConfig.projectId,
  noIndex = false,
  customMeta = [],
  bodyClass = ""
} = Astro.props;

// Generar título completo
const fullTitle = title === defaultConfig.title ? title : `${title} | UNE`;

// Headers de seguridad
if (Astro.response) {
  // Content Security Policy
  Astro.response.headers.set(
    'Content-Security-Policy',
    "default-src 'self'; script-src 'self' 'unsafe-inline' https://www.clarity.ms; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' https://www.clarity.ms; font-src 'self' https:; object-src 'none'; base-uri 'self'; frame-ancestors 'none';"
  );
  
  // X-Frame-Options para prevenir clickjacking
  Astro.response.headers.set('X-Frame-Options', 'DENY');
  
  // Cross-Origin Opener Policy
  Astro.response.headers.set('Cross-Origin-Opener-Policy', 'same-origin');
  
  // Strict Transport Security (solo para HTTPS)
  if (Astro.url.protocol === 'https:') {
    Astro.response.headers.set('Strict-Transport-Security', 'max-age=31536000; includeSubDomains; preload');
  }
  
  // Otros headers de seguridad
  Astro.response.headers.set('X-Content-Type-Options', 'nosniff');
  Astro.response.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin');
}
---

<html lang={lang}>
  <head>
    <meta charset={charset} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{fullTitle}</title>
    
    {/* Meta descripción */}
    {description && <meta name="description" content={description} />}
    
    {/* Control de indexación */}
    {noIndex ? (
      <meta name="robots" content="noindex, nofollow" />
    ) : (
      <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
    )}
    
    {/* Meta tags personalizados */}
    {customMeta.map((meta) => (
      <meta name={meta.name} content={meta.content} property={meta.property} />
    ))}
    
    {/* Meta tags optimizados para SEO */}
    <meta name="author" content="Universidad de Jalisco - UNE" />
    <meta name="keywords" content="universidad jalisco, educación superior, licenciaturas, posgrados, UNE, educación en línea, educación presencial, universidad especialidades" />
    <meta name="language" content="Spanish" />
    <meta name="geo.region" content="MX-JAL" />
    <meta name="geo.placename" content="Jalisco, México" />
    
    {/* Favicons completos - Configuración desde carpeta Favicon */}
    <link rel="icon" href="/Favicon/favicon.ico" sizes="any" />
    <link rel="icon" href="/Favicon/favicon-16x16.png" type="image/png" sizes="16x16" />
    <link rel="icon" href="/Favicon/favicon-32x32.png" type="image/png" sizes="32x32" />
    <link rel="icon" href="/Favicon/favicon-96x96.png" type="image/png" sizes="96x96" />
    
    {/* Apple Touch Icons */}
    <link rel="apple-touch-icon" href="/Favicon/apple-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/Favicon/apple-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/Favicon/apple-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/Favicon/apple-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/Favicon/apple-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/Favicon/apple-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/Favicon/apple-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/Favicon/apple-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/Favicon/apple-icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/Favicon/apple-icon-180x180.png" />
    <link rel="apple-touch-icon-precomposed" href="/Favicon/apple-icon-precomposed.png" />
    
    {/* Android Chrome Icons */}
    <link rel="icon" type="image/png" sizes="36x36" href="/Favicon/android-icon-36x36.png" />
    <link rel="icon" type="image/png" sizes="48x48" href="/Favicon/android-icon-48x48.png" />
    <link rel="icon" type="image/png" sizes="72x72" href="/Favicon/android-icon-72x72.png" />
    <link rel="icon" type="image/png" sizes="96x96" href="/Favicon/android-icon-96x96.png" />
    <link rel="icon" type="image/png" sizes="144x144" href="/Favicon/android-icon-144x144.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="/Favicon/android-icon-192x192.png" />
    
    {/* Microsoft Tiles */}
    <meta name="msapplication-TileImage" content="/Favicon/ms-icon-144x144.png" />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="msapplication-square70x70logo" content="/Favicon/ms-icon-70x70.png" />
    <meta name="msapplication-square150x150logo" content="/Favicon/ms-icon-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="/Favicon/ms-icon-310x310.png" />
    <meta name="msapplication-square310x310logo" content="/Favicon/ms-icon-310x310.png" />
    <meta name="msapplication-config" content="/Favicon/browserconfig.xml" />
    
    {/* Web App Manifest */}
    <link rel="manifest" href="/Favicon/manifest.json" />
    
    {/* Theme color para browsers móviles */}
    <meta name="theme-color" content="#ffffff" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="UNE" />
    
    {/* Schema.org para Google */}
    <script type="application/ld+json">
      {JSON.stringify({
        "@context": "https://schema.org",
        "@type": "EducationalOrganization",
        "name": "UNE - Universidad de Especialidades",
        "alternateName": "Universidad de Jalisco - UNE",
        "url": Astro.url.origin,
        "logo": `${Astro.url.origin}/Favicon/apple-icon-180x180.png`,
        "description": description || defaultConfig.description,
        "address": {
          "@type": "PostalAddress",
          "addressRegion": "Jalisco",
          "addressCountry": "MX"
        },
        "sameAs": [
          // Agregar redes sociales aquí cuando las tengas
        ]
      })}
    </script>
    
    {/* Open Graph optimizado */}
    <meta property="og:title" content={fullTitle} />
    <meta property="og:description" content={description || defaultConfig.description} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={Astro.url.href} />
    <meta property="og:image" content={`${Astro.url.origin}/Favicon/apple-icon-180x180.png`} />
    <meta property="og:image:width" content="180" />
    <meta property="og:image:height" content="180" />
    <meta property="og:locale" content="es_MX" />
    <meta property="og:site_name" content="Universidad de Jalisco - UNE" />
    
    {/* Twitter Card optimizado */}
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={fullTitle} />
    <meta name="twitter:description" content={description || defaultConfig.description} />
    <meta name="twitter:image" content={`${Astro.url.origin}/Favicon/apple-icon-180x180.png`} />
    <meta name="twitter:site" content="@UNEJalisco" />
    
    {/* Canonical URL para evitar contenido duplicado */}
    <link rel="canonical" href={Astro.url.href} />
    
    {/* Preconnect para Clarity para mejor performance */}
    <link rel="preconnect" href="https://www.clarity.ms" />
  </head>
  
  <body class={bodyClass}>
    {/* Cargar Clarity solo en el cliente */}
    <Clarity projectId={projectId} />
    
    {/* Estructura principal */}
    <Header />
    
    <main id="main-content" tabindex="-1">
      <slot />
    </main>
    
    <Footer />
    
    {/* Scripts adicionales si es necesario */}
    <slot name="scripts" />
  </body>
</html>