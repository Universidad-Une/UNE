---
// Layout principal de la aplicación con valores por defecto
import Header from "../components/layout/Header.astro";
import Footer from "../components/layout/Footer.astro";
import "../styles/global.css";
import Clarity from "../components/layout/Clarity.astro";

// Configuración por defecto
const defaultConfig = {
  projectId: "spfe9hsbw6",
  title: "UNE - Universidad de Especialidades",
  description: "Universidad UNE - 30 años creyendo en ti. Licenciaturas, posgrados y educación continua en línea y presencial.",
  lang: "es",
  charset: "UTF-8",
  ogImage: "/og-image.jpg" // 👈 Fallback: public/og-image.jpg
};

// Extraer props con valores por defecto
const { 
  title = defaultConfig.title,
  description = defaultConfig.description,
  lang = defaultConfig.lang,
  charset = defaultConfig.charset,
  projectId = defaultConfig.projectId,
  noIndex = false,
  customMeta = [],
  bodyClass = "",
  ogImage = defaultConfig.ogImage // 👈 Nueva prop
} = Astro.props;

// Generar título completo
const fullTitle = title === defaultConfig.title ? title : `${title} | UNE`;

// URL completa de la imagen
const fullOgImage = `${Astro.url.origin}${ogImage}`;

// Headers de seguridad (tu código actual)
if (Astro.response) {
  // ... tu código de headers actual ...
}
---

<html lang={lang}>
  <head>
    <meta charset={charset} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{fullTitle}</title>
    
    {/* Meta descripción */}
    {description && <meta name="description" content={description} />}
    
    {/* Control de indexación */}
    {noIndex ? (
      <meta name="robots" content="noindex, nofollow" />
    ) : (
      <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
    )}
    
    {/* Meta tags personalizados */}
    {customMeta.map((meta) => (
      <meta name={meta.name} content={meta.content} property={meta.property} />
    ))}
    
    {/* Meta tags SEO básicos */}
    <meta name="author" content="Universidad de Jalisco - UNE" />
    <meta name="geo.region" content="MX-JAL" />
    <meta name="geo.placename" content="Jalisco, México" />
    
    {/* Favicons esenciales */}
    <link rel="icon" href="/Favicon/favicon.ico" sizes="any" />
    <link rel="apple-touch-icon" href="/Favicon/apple-icon-180x180.png" />
    <link rel="manifest" href="/Favicon/manifest.json" />
    
    {/* Theme color para móviles */}
    <meta name="theme-color" content="#ffffff" />
    <meta name="apple-mobile-web-app-title" content="UNE" />
    
    {/* Preconnect solo para Clarity */}
    <link rel="preconnect" href="https://www.clarity.ms" />
    
    {/* Schema.org para Google */}
    <script type="application/ld+json">
      {JSON.stringify({
        "@context": "https://schema.org",
        "@type": "EducationalOrganization",
        "name": "UNE - Universidad de Especialidades",
        "alternateName": "Universidad de Jalisco - UNE",
        "url": Astro.url.origin,
        "logo": `${Astro.url.origin}/Favicon/apple-icon-180x180.png`,
        "image": fullOgImage, // 👈 Imagen en el schema
        "description": description || defaultConfig.description,
        "address": {
          "@type": "PostalAddress",
          "addressRegion": "Jalisco",
          "addressCountry": "MX"
        }
      })}
    </script>
    
    {/* Open Graph optimizado */}
    <meta property="og:title" content={fullTitle} />
    <meta property="og:description" content={description || defaultConfig.description} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={Astro.url.href} />
    <meta property="og:image" content={fullOgImage} /> {/* 👈 Nueva imagen */}
    <meta property="og:image:width" content="1200" /> {/* 👈 Dimensiones correctas */}
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content={`${fullTitle} - Logo`} /> {/* 👈 Alt text */}
    <meta property="og:locale" content="es_MX" />
    <meta property="og:site_name" content="Universidad de Jalisco - UNE" />
    
    {/* Twitter Card optimizado */}
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={fullTitle} />
    <meta name="twitter:description" content={description || defaultConfig.description} />
    <meta name="twitter:image" content={fullOgImage} /> {/* 👈 Nueva imagen */}
    <meta name="twitter:image:alt" content={`${fullTitle} - Logo`} />
    <meta name="twitter:site" content="@une_universidad" />
    
    {/* Canonical URL */}
    <link rel="canonical" href={Astro.url.href} />
  </head>
  
  <body class={bodyClass}>
    <Clarity projectId={projectId} />
    
    <Header />
    
    <main id="main-content" tabindex="-1">
      <slot />
    </main>
    
    <Footer />
    
    <slot name="scripts" />
  </body>
</html>