---
import Layout from "@/layouts/Layout.astro";
import Hero from "@/assets/Imagenes/Heros/FAQ.webp";
import HeroMobile from "@/assets/Imagenes/Heros/FAQ_mobile.webp";
import Middle from "@/assets/Imagenes/Middles/Sillas.webp";
import { Search, Plus, Minus } from "@lucide/astro";
---

<Layout>
    <main class="min-h-screen">
        <!-- Hero Section -->
        <section class="relative min-h-[65vh] overflow-hidden bg-cover bg-center bg-no-repeat">
            <!-- Desktop Background -->
            <div
                class="absolute inset-0 hidden md:block bg-cover bg-center bg-no-repeat"
                style={{ backgroundImage: `url(${Hero.src})` }}
            ></div>

            <!-- Mobile Background -->
            <div
                class="absolute inset-0 block md:hidden bg-cover bg-center bg-no-repeat"
                style={{ backgroundImage: `url(${HeroMobile.src})` }}
            ></div>

            <!-- Hero Content -->
            <div class="relative z-10 container mx-auto px-4 h-full min-h-[65vh] flex flex-col md:flex-row items-center justify-center md:justify-end">
                <div class="w-full max-w-7xl flex flex-col md:flex-row items-center justify-between">
                    <!-- Left side - FAQ Title -->
                    <div class="flex items-center space-x-4 mb-6 md:mb-0 md:space-x-8 text-white">
                        <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                            <Search class="w-8 h-8 text-white" />
                        </form>
                        <h1 class="text-4xl md:text-6xl font-bold tracking-wider">FAQ</h1>
                    </div>

                    <!-- Right side - Welcome message -->
                    <div class="bg-white rounded-lg p-6 max-w-sm shadow-lg text-center md:text-left">
                        <h2 class="text-xl font-bold text-gray-800 mb-3">
                            ¡Hola! ¿Cómo podemos ayudarte?
                        </h2>
                        <p class="text-gray-600 text-sm leading-relaxed">
                            Esta sección de Preguntas Frecuentes está diseñada para resolver tus dudas de manera ágil. Navega por nuestros temas o utiliza el buscador para encontrar respuestas instantáneas. Si no encuentras lo que buscas, no dudes en contactarnos.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Content -->
        <section class="py-16 bg-gray-50">
            <div class="container mx-auto px-4">
                <!-- Section Title -->
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold text-blue-900 mb-4">
                        Todo lo que necesitas saber, en<br />
                        un solo lugar.
                    </h2>
                </div>

                <!-- FAQ Grid -->
                <div class="max-w-6xl mx-auto grid md:grid-cols-2 gap-4">
                    <!-- FAQ Item 1 -->
                    <div class="faq-item bg-azul-une text-white rounded-lg cursor-pointer hover:bg-blue-800 transition-colors duration-300 group">
                        <div class="faq-question p-6 flex items-center justify-between">
                            <h3 class="text-lg font-semibold">
                                ¿Cuáles son los requisitos de ingreso?
                            </h3>
                            <div class="faq-icon w-6 h-6 transform group-hover:rotate-45 transition-transform duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
                            </div>
                        </div>
                        <div class="faq-answer bg-blue-800 p-6 hidden">
                            <p class="text-white">
                                Para el ingreso necesitas: certificado de
                                bachillerato, acta de nacimiento, CURP,
                                fotografías tamaño infantil, y aprobar el examen
                                de admisión. También debes completar el proceso
                                de inscripción en línea.
                            </p>
                        </div>
                    </div>

                    <!-- FAQ Item 2 -->
                    <div class="faq-item bg-azul-une text-white rounded-lg cursor-pointer hover:bg-blue-800 transition-colors duration-300 group">
                        <div class="faq-question p-6 flex items-center justify-between">
                            <h3 class="text-lg font-semibold">
                                ¿Puedo revalidar materias de otra universidad?
                            </h3>
                            <div class="faq-icon w-6 h-6 transform group-hover:rotate-45 transition-transform duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
                            </div>
                        </div>
                        <div class="faq-answer bg-blue-800 p-6 hidden">
                            <p class="text-white">
                                Sí, puedes revalidar materias de otras
                                universidades. Debes presentar tu kardex oficial
                                y los programas de las materias que deseas
                                revalidar. Nuestro departamento académico
                                evaluará la equivalencia.
                            </p>
                        </div>
                    </div>

                    <!-- FAQ Item 3 -->
                    <div class="faq-item bg-azul-une text-white rounded-lg cursor-pointer hover:bg-blue-800 transition-colors duration-300 group">
                        <div class="faq-question p-6 flex items-center justify-between">
                            <h3 class="text-lg font-semibold">
                                ¿Las carreras están incorporadas a SICYT o UdeG?
                            </h3>
                            <div class="faq-icon w-6 h-6 transform group-hover:rotate-45 transition-transform duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
                            </div>
                        </div>
                        <div class="faq-answer bg-blue-800 p-6 hidden">
                            <p class="text-white">
                                Nuestras carreras están incorporadas al Sistema
                                de Educación Superior de Jalisco (SICYT) y
                                tienen validez oficial. Esto garantiza que tu
                                título será reconocido a nivel nacional.
                            </p>
                        </div>
                    </div>

                    <!-- FAQ Item 4 -->
                    <div class="faq-item bg-azul-une text-white rounded-lg cursor-pointer hover:bg-blue-800 transition-colors duration-300 group">
                        <div class="faq-question p-6 flex items-center justify-between">
                            <h3 class="text-lg font-semibold">
                                ¿Cómo puedo agendar una visita?
                            </h3>
                            <div class="faq-icon w-6 h-6 transform group-hover:rotate-45 transition-transform duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
                            </div>
                        </div>
                        <div class="faq-answer bg-blue-800 p-6 hidden">
                            <p class="text-white">
                                Puedes agendar una visita llamando a nuestro
                                número telefónico, enviando un WhatsApp o
                                rellenando el formulario de contacto. Te
                                asignaremos un horario conveniente para ti.
                            </p>
                        </div>
                    </div>

                    <!-- FAQ Item 5 -->
                    <div class="faq-item bg-azul-une text-white rounded-lg cursor-pointer hover:bg-blue-800 transition-colors duration-300 group">
                        <div class="faq-question p-6 flex items-center justify-between">
                            <h3 class="text-lg font-semibold">
                                ¿Ofrecen becas o apoyos económicos?
                            </h3>
                            <div class="faq-icon w-6 h-6 transform group-hover:rotate-45 transition-transform duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
                            </div>
                        </div>
                        <div class="faq-answer bg-blue-800 p-6 hidden">
                            <p class="text-white">
                                Sí, contamos con diferentes tipos de becas: por
                                mérito académico, necesidad económica, y
                                convenios con empresas. También ofrecemos planes
                                de pago flexibles y descuentos por pronto pago.
                            </p>
                        </div>
                    </div>

                    <!-- FAQ Item 6 -->
                    <div class="faq-item bg-azul-une text-white rounded-lg cursor-pointer hover:bg-blue-800 transition-colors duration-300 group">
                        <div class="faq-question p-6 flex items-center justify-between">
                            <h3 class="text-lg font-semibold">
                                ¿Cuáles son las fechas de inicio de clases?
                            </h3>
                            <div class="faq-icon w-6 h-6 transform group-hover:rotate-45 transition-transform duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
                            </div>
                        </div>
                        <div class="faq-answer bg-blue-800 p-6 hidden">
                            <p class="text-white">
                                Tenemos tres períodos de inicio: enero, mayo y
                                agosto. Las fechas exactas varían cada año, pero
                                generalmente inician la segunda semana de cada
                                mes mencionado.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section
            class="relative py-16 text-white overflow-hidden bg-cover bg-center bg-no-repeat"
            style={{ backgroundImage: `url(${Middle.src})` }}
        >
            <div class="relative z-10 container mx-auto px-4">
                <div class="max-w-4xl mx-auto grid md:grid-cols-2 gap-8 items-center">
                    <!-- Left side - Question -->
                    <div>
                        <h2 class="text-4xl font-bold mb-4">
                            ¿Necesitas una respuesta<br />
                            rápida?
                        </h2>
                        <p class="text-xl text-gray-300">
                            Nuestro equipo está siempre para ti
                        </p>
                    </div>

                    <!-- Right side - Contact Form -->
                    <form id="contact-form" class="space-y-5">
                        <div>
                            <input
                                type="text"
                                name="nombre"
                                placeholder="Nombre(s)"
                                required
                                class="w-full px-4 py-3 bg-transparent border-b-2 border-gray-500 focus:border-white outline-none transition-colors duration-300 placeholder:text-gray-400"
                            />
                        </div>
                        <div>
                            <input
                                type="text"
                                name="apellidos"
                                placeholder="Apellidos"
                                required
                                class="w-full px-4 py-3 bg-transparent border-b-2 border-gray-500 focus:border-white outline-none transition-colors duration-300 placeholder:text-gray-400"
                            />
                        </div>
                        <div>
                            <input
                                type="email"
                                name="correo"
                                placeholder="Correo electrónico"
                                required
                                class="w-full px-4 py-3 bg-transparent border-b-2 border-gray-500 focus:border-white outline-none transition-colors duration-300 placeholder:text-gray-400"
                            />
                        </div>
                        <div>
                            <input
                                type="tel"
                                name="telefono"
                                placeholder="Celular"
                                required
                                class="w-full px-4 py-3 bg-transparent border-b-2 border-gray-500 focus:border-white outline-none transition-colors duration-300 placeholder:text-gray-400"
                            />
                        </div>
                        <div class="flex justify-center pt-4">
                            <button
                                type="submit"
                                id="submit-btn"
                                class="bg-red-600 hover:bg-red-700 text-white px-8 py-3 rounded-lg font-semibold transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                                aria-label="Registrar interés" 
                                title="Registrar interés"
                            >
                                <span class="btn-text">Registrar interés</span>
                                <span class="btn-loading hidden">Enviando...</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
</Layout>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // FAQ functionality
        const faqItems = document.querySelectorAll(".faq-item");

        faqItems.forEach((item) => {
            const question = item.querySelector(".faq-question");
            const answer = item.querySelector(".faq-answer");
            const iconContainer = item.querySelector(".faq-icon");

            if (question && answer && iconContainer) {
                question.addEventListener("click", function () {
                    const isOpen = !answer.classList.contains("hidden");

                    // Close all other FAQ items
                    faqItems.forEach((otherItem) => {
                        if (otherItem !== item) {
                            const otherAnswer = otherItem.querySelector(".faq-answer");
                            const otherIconContainer = otherItem.querySelector(".faq-icon");
                            
                            if (otherAnswer && otherIconContainer) {
                                otherAnswer.classList.add("hidden");
                                // Show Plus icon
                                otherIconContainer.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>';
                            }
                        }
                    });

                    if (isOpen) {
                        // Close current item - show Plus icon
                        answer.classList.add("hidden");
                        iconContainer.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>';
                    } else {
                        // Open current item - show Minus icon
                        answer.classList.remove("hidden");
                        iconContainer.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 12H6"/></svg>';
                    }
                });
            }
        });

        // Contact form functionality
        const contactForm = document.getElementById('contact-form');
        const submitBtn = document.getElementById('submit-btn');
        const btnText = submitBtn.querySelector('.btn-text');
        const btnLoading = submitBtn.querySelector('.btn-loading');

        if (contactForm && submitBtn) {
            contactForm.addEventListener('submit', async function(e) {
                e.preventDefault();

                // Get form data
                const formData = new FormData(contactForm);
                const nombre = formData.get('nombre').trim();
                const apellidos = formData.get('apellidos').trim();
                const correo = formData.get('correo').trim();
                const telefono = formData.get('telefono').trim();

                // Basic validation
                if (!nombre || !apellidos || !correo || !telefono) {
                    alert('Por favor completa todos los campos');
                    return;
                }

                // Email validation
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(correo)) {
                    alert('Por favor ingresa un correo electrónico válido');
                    return;
                }

                // Split apellidos into apellido_p and apellido_m
                const apellidosParts = apellidos.split(' ');
                const apellido_p = apellidosParts[0] || '';
                const apellido_m = apellidosParts[1] || 'Pendiente';

                // Disable button and show loading
                submitBtn.disabled = true;
                btnText.classList.add('hidden');
                btnLoading.classList.remove('hidden');

                try {
                    const requestData = {
                        "nombre": nombre,
                        "apellido_p": apellido_p,
                        "apellido_m": apellido_m,
                        "correo": correo,
                        "nivel_educativo": "Pendiente",
                        "plantel_interes": "Pendiente",
                        "programa_interes": "Pendiente",
                        "telefono": telefono,
                        "modalidad": "Pendiente"
                    };

                    const response = await fetch('https://www.universidad-une.com/api/v2/custom/une_create_crm', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Basic b3NjYXIubXVyb0B4bWFydHMuY29tOkxlZHhPc2Nhck11cm8='
                        },
                        body: JSON.stringify(requestData)
                    });

                    if (response.ok) {
                        // Redirect to thank you page without showing any alert
                        window.location.href = '/contacto/gracias';
                    } else {
                        throw new Error(`Error ${response.status}`);
                    }

                } catch (error) {
                    alert('Hubo un error al enviar tu mensaje. Por favor intenta nuevamente.');
                    
                    // Re-enable button
                    submitBtn.disabled = false;
                    btnText.classList.remove('hidden');
                    btnLoading.classList.add('hidden');
                }
            });
        }
    });
</script>

<style>
    /* Custom blue color if not defined in Tailwind config */
    .bg-azul-une {
        background-color: #1e40af; /* Fallback blue color */
    }
    
    /* Smooth transitions for FAQ items */
    .faq-answer {
        transition: all 0.3s ease-in-out;
    }
    
    /* Ensure icons maintain consistent size */
    .faq-icon {
        min-width: 1.5rem;
        min-height: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    /* Placeholder styling for better visibility */
    .placeholder\:text-gray-400::placeholder {
        color: rgb(156, 163, 175);
    }
</style>