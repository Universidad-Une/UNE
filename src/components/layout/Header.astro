---
import { Menu, X, ChevronDown } from "@lucide/astro";
import Logo_UNE from "@logos/UNE_com.webp";
import UNE_Blanco from "@logos/UNE_blanco.webp";
import UNE_enlinea from "@logos/UNE_en_linea_blanco.webp";
import Enjoy from "@logos/Enjoy_english_blanco.webp";
import VTU from "@logos/VTU_blanco.webp";

// Configuración de datos
const topBarLinks = [
  { href: "https://www.une-enlinea.com/", img: UNE_enlinea, alt: "UNE en línea" },
  { href: "/Vivetuuniversidad/General", img: VTU, alt: "Vive tu Universidad" },
  { href: "https://sites.google.com/universidad-une.com/enjoyenglish", img: Enjoy, alt: "Enjoy English" },
];

const navItems = [
  {
    label: "Admisiones",
    dropdownClass: "admisiones-dropdown",
    links: [
      { href: "/acerca/Admisiones", title: "Admisiones", desc: "Descubre todo sobre el proceso" },
      { href: "/contacto/formulario-inscripcion", title: "Formulario de inscripción", desc: "Inicia tu proceso de admisión" },
      { href: "/acerca/PreguntasFrecuentes", title: "Preguntas frecuentes", desc: "Resuelve tus dudas" },
      { href: "/acerca/Apoyos", title: "Apoyos educativos", desc: "Conoce los apoyos a los cuales puedes acceder" },
    ]
  },
  {
    label: "Oferta académica",
    dropdownClass: "oferta-dropdown",
    customContent: true
  },
  {
    label: "Información escolar",
    dropdownClass: "informacion-dropdown",
    links: [
      { href: "/informacionescolar/serviciosescolares", title: "Servicios escolares", desc: "Inscripciones, constancias y trámites académicos." },
      { href: "/informacionescolar/Serviciosocial", title: "Servicio social", desc: "Información sobre requisitos, procesos y calendarios oficiales." },
      { href: "/informacionescolar/Practicasprofesionales", title: "Prácticas profesionales", desc: "Encuentra convenios, formatos y pasos para iniciar tus prácticas." },
      { href: "/informacionescolar/Bibliotecas", title: "Biblioteca digital", desc: "Consulta libros, revistas y bases de datos académicas en línea." },
    ]
  },
  {
    label: "Vida estudiantil",
    dropdownClass: "vida-dropdown",
    links: [
      { href: "/vidaestudiantil/General", title: "Comunidad UNE", desc: "Descubre todo lo que es UNE" },
      { href: "/Vivetuuniversidad/General", title: "Vive tu universidad", desc: "Actividades deportivas" },
      { href: "/blog/General", title: "Blog", desc: "Descubre sobre nuevos temas," },
      { href: "/Orgulloune/General", title: "Orgullo UNE", desc: "Conoce los egresados más destacados" },
      { href: "/Vivetuuniversidad/Congresos", title: "Congresos UNE", desc: "Conoce los egresados más destacados" },
      { href: "/contacto/atencion-estudiantes", title: "Atención a estudiantes", desc: "Apoyo para tramites o problemas" },
    ]
  },
  {
    label: "Nosotros",
    dropdownClass: "nosotros-dropdown",
    links: [
      { href: "/planteles/general", title: "Planteles", desc: "Conoce nuestras sedes y su oferta académica." },
      { href: "/acerca/historia", title: "Historia sobre nosotros", desc: "Descubre nuestra trayectoria y misión educativa." },
      { href: "/acerca/beneficios", title: "Beneficios permanencia", desc: "Apoyos y servicios que fortalecen tu experiencia." },
      { href: "/contacto/solicitarinformacion", title: "Contacto", desc: "Canales directos para resolver tus dudas." },
      { href: "/contacto/solicitarvisita", title: "Agendar una visita", desc: "Explora nuestro campus de forma personalizada." },
    ]
  }
];

// Datos de oferta académica
const ofertaAcademica = {
  colegioUNE: [
    { href: "/oferta/colegio-une/Primaria", title: "Primaria" },
    { href: "/oferta/colegio-une/Secundaria", title: "Secundaria" },
  ],
  medioSuperior: [
    { href: "/oferta/colegio-une/Bachillerato-sej", title: "Bachillerato Semiescolarizado" },
    { href: "/oferta/colegio-une/Bachillerato-udg", title: "Bachillerato UDG" },
    { href: "https://www.une-enlinea.com/bachillerato", title: "Bachillerato Virtual" },
  ],
  educacionSuperior: [
    { href: "/oferta/Licenciaturas", title: "Licenciaturas", desc: "Programas de pregrado" },
    { href: "/oferta/Maestria", title: "Maestrías", desc: "Posgrado académico y profesional" },
    { href: "/oferta/Especialidades", title: "Especialidades", desc: "Posgrado corto y especializado" },
  ],
  educacionContinua: [
    { href: "/oferta/Continua", title: "Educación continua", desc: "Cursos para actualizar conocimientos" },
    { href: "/oferta/Diplomados", title: "Diplomados", desc: "Programas breves sin grado académico" },
  ]
};

// Función para determinar el grid columns
function getGridCols(dropdownClass) {
  switch(dropdownClass) {
    case 'admisiones-dropdown': return 'grid-cols-4';
    case 'informacion-dropdown': return 'grid-cols-4';
    case 'vida-dropdown': return 'grid-cols-6';
    case 'nosotros-dropdown': return 'grid-cols-5';
    default: return 'grid-cols-4';
  }
}
---

<!-- Preload critical images -->
<link rel="preload" as="image" href={Logo_UNE.src} />
<link rel="preload" as="image" href={UNE_Blanco.src} media="(max-width: 768px)" />

<!-- Top Bar -->
<div class="hidden md:flex w-full h-14 bg-rojo-une items-center justify-end gap-5 px-4 rounded-b-3xl">
  {topBarLinks.map(link => (
    <a href={link.href}>
      <img 
        src={link.img.src} 
        alt={link.alt} 
        class="h-12 w-auto" 
        loading="lazy"
        decoding="async"
        width="auto"
        height="48"
      />
    </a>
  ))}
</div>

<header class="bg-white/50 backdrop-blur-[10.2px] shadow-sm sticky top-0 z-50">
  <div class="w-full">
    <div class="flex items-center justify-between h-24">
      <!-- Logo -->
      <div class="flex-shrink-0">
        <a href="/">
          <img 
            src={Logo_UNE.src} 
            alt="UNE" 
            class="h-20 w-auto md:h-14 lg:h-24 lg:border-0" 
            width="auto"
            height="96"
            decoding="async"
            fetchpriority="high"
          />
        </a>
      </div>

      <!-- Desktop Navigation -->
      <nav class="hidden md:flex lg:space-x-4 items-center">
        {navItems.map((item) => (
          <div class="relative group">
            <button class="flex items-center px-3 py-2 hover:text-red-600 font-bold transition-colors duration-200">
              {item.label}
              <ChevronDown size={16} class="ml-1 transform group-hover:rotate-180 transition-transform duration-200" />
            </button>
          </div>
        ))}
      </nav>

      <!-- Mobile Menu Button -->
      <div class="md:hidden">
        <button type="button" class="mobile-menu-button p-2 rounded-md text-blue-900 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
          <Menu size={24} stroke-width={2} class="menu-icon" />
          <X size={24} stroke-width={2} class="close-icon hidden" />
        </button>
      </div>
    </div>
  </div>

  <!-- Desktop Dropdowns -->
  {navItems.map(item => (
    <div class={`dropdown-menu ${item.dropdownClass} absolute left-0 right-0 top-full bg-white border-t border-gray-200 shadow-lg opacity-0 invisible transform translate-y-2 transition-all duration-300 ease-out z-50`}>
      <div class="container mx-auto px-4 py-6">
        {item.customContent ? (
          <!-- Oferta Académica Custom Content -->
          <div>
            <div class="mb-6">
              <div class="grid grid-cols-1 md:grid-cols-5 gap-3 mb-3">
                <div class="md:col-span-2">
                  <h2 class="text-base font-bold text-azul-une mb-3 border-b border-gray-200 pb-1">Colegio UNE</h2>
                </div>
                <div class="md:col-span-3">
                  <h2 class="text-base font-bold text-azul-une mb-3 border-b border-gray-200 pb-1">Medio Superior</h2>
                </div>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-5 gap-3">
                {[...ofertaAcademica.colegioUNE, ...ofertaAcademica.medioSuperior].map(link => (
                  <a href={link.href} class="group block p-3 rounded-lg hover:bg-blue-50 transition-colors duration-200">
                    <h3 class="font-semibold text-gray-900 group-hover:text-blue-600">{link.title}</h3>
                  </a>
                ))}
              </div>
            </div>
            <div class="mb-6">
              <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-3">
                <div class="md:col-span-3">
                  <h2 class="text-base font-bold text-azul-une mb-3 border-b border-gray-200 pb-1">Educación Superior</h2>
                </div>
                <div class="md:col-span-2">
                  <h2 class="text-base font-bold text-azul-une mb-3 border-b border-gray-200 pb-1">Educación Continua</h2>
                </div>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                {[...ofertaAcademica.educacionSuperior, ...ofertaAcademica.educacionContinua].map(link => (
                  <a href={link.href} class="group block p-3 rounded-lg hover:bg-blue-50 transition-colors duration-200">
                    <h3 class="font-semibold text-gray-900 group-hover:text-blue-600 mb-1">{link.title}</h3>
                    {link.desc && <p class="text-sm text-gray-500">{link.desc}</p>}
                  </a>
                ))}
              </div>
            </div>
          </div>
        ) : (
          <div class={'grid ' + getGridCols(item.dropdownClass) + ' gap-4'}>
            {item.links?.map(link => (
              <a href={link.href} class="group block p-3 rounded-lg hover:bg-blue-50 transition-colors duration-200">
                <h3 class="font-semibold text-gray-900 group-hover:text-blue-600 mb-1">{link.title}</h3>
                {link.desc && <p class="text-sm text-gray-500">{link.desc}</p>}
              </a>
            ))}
          </div>
        )}
      </div>
    </div>
  ))}

  <!-- Mobile Menu -->
  <div class="mobile-menu fixed inset-0 z-50 opacity-0 invisible transition-opacity duration-300 ease-in-out">
    <div class="w-full h-screen bg-azul-une flex transform -translate-x-full transition-transform duration-300 ease-in-out">
      <div class="w-[75%] h-full flex flex-col">
        <div class="flex items-center justify-between p-4 absolute w-full">
          <!-- Logo blanco pre-cargado para móvil -->
          <img 
            src={UNE_Blanco.src}
            alt="UNE" 
            class="h-20 w-auto mobile-logo" 
            width="auto"
            height="80"
            loading="lazy"
            decoding="async"
          />
          <button type="button" class="close-menu-button p-2 text-white hover:bg-blue-800 rounded-md">
            <X size={32} />
          </button>
        </div>

        <nav class="flex-1 p-4 overflow-y-auto mt-40">
          <div class="mb-4">
            <a href="/" class="menu-section flex items-center justify-between w-full text-left text-white font-bold py-3 px-2 hover:bg-blue-800 rounded-md transition-colors duration-200">
              <span class="font-bold text-lg tracking-wide">INICIO</span>
            </a>
          </div>

          {navItems.map(item => (
            <div class="mb-4">
              <button class="menu-section-button flex items-center justify-between w-full text-left text-white font-bold py-3 px-2 hover:bg-blue-800 rounded-md transition-colors duration-200">
                <span class="font-bold text-lg tracking-wide">{item.label.toUpperCase()}</span>
                <ChevronDown size={20} class="chevron transform transition-transform duration-200" />
              </button>
              <div class="submenu hidden ml-4 mt-2 space-y-1">
                {item.customContent ? (
                  <!-- Mobile Oferta Académica -->
                  <>
                    <div class="mb-2">
                      <h3 class="text-gray-300 font-semibold py-2 px-2 text-sm">Colegio UNE</h3>
                      <div class="ml-2 space-y-1">
                        {ofertaAcademica.colegioUNE.map(link => (
                          <a href={link.href} class="block text-gray-300 py-2 px-2 text-sm hover:text-white hover:bg-blue-800 rounded">
                            {link.title}
                          </a>
                        ))}
                      </div>
                    </div>
                    <div class="mb-2">
                      <h3 class="text-gray-300 font-semibold py-2 px-2 text-sm">Medio Superior</h3>
                      <div class="ml-2 space-y-1">
                        {ofertaAcademica.medioSuperior.map(link => (
                          <a href={link.href} class="block text-gray-300 py-2 px-2 text-sm hover:text-white hover:bg-blue-800 rounded">
                            {link.title}
                          </a>
                        ))}
                      </div>
                    </div>
                    <div class="mb-2">
                      <h3 class="text-gray-300 font-semibold py-2 px-2 text-sm">Educación Superior</h3>
                      <div class="ml-2 space-y-1">
                        {ofertaAcademica.educacionSuperior.map(link => (
                          <a href={link.href} class="block text-gray-300 py-2 px-2 text-sm hover:text-white hover:bg-blue-800 rounded">
                            {link.title}
                          </a>
                        ))}
                      </div>
                    </div>
                    <div>
                      <h3 class="text-gray-300 font-semibold py-2 px-2 text-sm">Educación Continua</h3>
                      <div class="ml-2 space-y-1">
                        {ofertaAcademica.educacionContinua.map(link => (
                          <a href={link.href} class="block text-gray-300 py-2 px-2 text-sm hover:text-white hover:bg-blue-800 rounded">
                            {link.title}
                          </a>
                        ))}
                      </div>
                    </div>
                  </>
                ) : (
                  item.links?.map(link => (
                    <a href={link.href} class="block text-gray-300 py-2 px-2 text-sm hover:text-white hover:bg-blue-800 rounded">
                      {link.title}
                    </a>
                  ))
                )}
              </div>
            </div>
          ))}
        </nav>
      </div>

      <div class="w-[25%] h-full flex items-center justify-center">
        <div class="w-full h-[70dvh] bg-rojo-une flex flex-col items-center justify-center gap-5 space-y-4 px-4 rounded-l-2xl">
          {topBarLinks.map(link => (
            <img 
              src={link.img.src} 
              alt={link.alt} 
              class="h-20 w-auto" 
              loading="lazy"
              decoding="async"
              width="auto"
              height="80"
            />
          ))}
        </div>
      </div>
    </div>
  </div>
</header>

<script>
  // Mobile menu functionality
  const mobileMenuButton = document.querySelector(".mobile-menu-button");
  const mobileMenu = document.querySelector(".mobile-menu");
  const closeMenuButton = document.querySelector(".close-menu-button");
  const menuIcon = document.querySelector(".menu-icon");
  const closeIcon = document.querySelector(".close-icon");
  const menuContainer = mobileMenu?.querySelector("div:first-child");

  function toggleMenu(open) {
    if (open) {
      mobileMenu?.classList.remove("opacity-0", "invisible");
      mobileMenu?.classList.add("opacity-100", "visible");
      menuContainer?.classList.remove("-translate-x-full");
      menuIcon?.classList.add("hidden");
      closeIcon?.classList.remove("hidden");
      document.body.style.overflow = "hidden";
    } else {
      menuContainer?.classList.add("-translate-x-full");
      setTimeout(() => {
        mobileMenu?.classList.remove("opacity-100", "visible");
        mobileMenu?.classList.add("opacity-0", "invisible");
        menuIcon?.classList.remove("hidden");
        closeIcon?.classList.add("hidden");
        document.body.style.overflow = "";
      }, 300);
    }
  }

  mobileMenuButton?.addEventListener("click", () => toggleMenu(true));
  closeMenuButton?.addEventListener("click", () => toggleMenu(false));

  // Desktop dropdown functionality
  const navItems = document.querySelectorAll("nav .group");
  const dropdowns = document.querySelectorAll(".dropdown-menu");
  const dropdownMap = ["admisiones-dropdown", "oferta-dropdown", "informacion-dropdown", "vida-dropdown", "nosotros-dropdown"];

  navItems.forEach((item, index) => {
    const dropdown = document.querySelector(`.${dropdownMap[index]}`);
    if (!dropdown) return;

    let hoverTimeout;
    const showDropdown = () => {
      clearTimeout(hoverTimeout);
      dropdowns.forEach(d => {
        const isCurrentDropdown = d === dropdown;
        d.classList.toggle("opacity-100", isCurrentDropdown);
        d.classList.toggle("visible", isCurrentDropdown);
        d.classList.toggle("opacity-0", !isCurrentDropdown);
        d.classList.toggle("invisible", !isCurrentDropdown);
        d.classList.toggle("translate-y-0", isCurrentDropdown);
        d.classList.toggle("translate-y-2", !isCurrentDropdown);
      });
    };

    const hideDropdown = () => {
      hoverTimeout = setTimeout(() => {
        dropdown.classList.remove("opacity-100", "visible", "translate-y-0");
        dropdown.classList.add("opacity-0", "invisible", "translate-y-2");
      }, 100);
    };

    item.addEventListener("mouseenter", showDropdown);
    item.addEventListener("mouseleave", hideDropdown);
    dropdown.addEventListener("mouseenter", () => clearTimeout(hoverTimeout));
    dropdown.addEventListener("mouseleave", hideDropdown);
  });

  // Mobile submenu functionality - Selector corregido
  document.querySelectorAll(".menu-section-button").forEach(section => {
    section.addEventListener("click", () => {
      const submenu = section.nextElementSibling;
      const chevron = section.querySelector(".chevron");
      submenu?.classList.toggle("hidden");
      chevron?.classList.toggle("rotate-180");
    });
  });

  // Close menu on escape key
  document.addEventListener("keydown", e => {
    if (e.key === "Escape") {
      toggleMenu(false);
      dropdowns.forEach(dropdown => {
        dropdown.classList.remove("opacity-100", "visible", "translate-y-0");
        dropdown.classList.add("opacity-0", "invisible", "translate-y-2");
      });
    }
  });
</script>

<style>
  .dropdown-menu {
    transform: translateY(8px);
  }

  .dropdown-menu.translate-y-0 {
    transform: translateY(0);
  }

  .dropdown-menu.translate-y-2 {
    transform: translateY(8px);
  }
</style>