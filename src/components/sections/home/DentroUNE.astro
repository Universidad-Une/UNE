---
import videoSrc from 'src/assets/Videos/UExperiencia.mp4';

// Generar un ID único para este componente
const uniqueId = 'dentro-une-' + Math.random().toString(36).substr(2, 9);
---

<!-- Título -->
<div class="text-center">
  <h2 class="text-4xl md:text-5xl font-bold text-gray-900">Dentro de UNE</h2>
</div>

<!-- Sección principal -->
<section class="bg-white py-16 px-4" id={`${uniqueId}-section`}>
  <div class="max-w-7xl mx-auto">
    <div class="flex flex-col lg:flex-row gap-12 items-center">
      <!-- Video -->
      <div class="w-full lg:w-1/2 order-1 lg:order-2">
        <div class="relative rounded-2xl overflow-hidden shadow-2xl">
          <video
            id={`${uniqueId}-video`}
            class="w-full h-auto aspect-[4/3] object-cover"
            muted
            loop
            playsinline
            preload="none"
            data-src={videoSrc}
          >
            <source data-src={videoSrc} type="video/mp4" />
            <img
              src="/Images/Fondo-plantel.webp"
              alt="Estudiantes UNE"
              class="w-full h-full object-cover"
            />
          </video>

          <!-- Controles de video -->
          <div class="absolute top-4 left-4 flex gap-2">
            <!-- Botón de play/pause -->
            <button
              id={`${uniqueId}-play-pause`}
              class="w-12 h-12 bg-black/60 hover:bg-black/80 rounded-full flex items-center justify-center shadow-lg transition-all duration-300 backdrop-blur-sm border border-white/20"
              aria-label="Reproducir" 
              title="Reproducir contenido multimedia"
            >
              <span id={`${uniqueId}-play-icon`} class="text-white">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polygon points="5,3 19,12 5,21"></polygon>
                </svg>
              </span>
              <span id={`${uniqueId}-pause-icon`} class="text-white hidden">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="6" y="4" width="4" height="16"></rect>
                  <rect x="14" y="4" width="4" height="16"></rect>
                </svg>
              </span>
            </button>

            <!-- Botón de audio -->
            <button
              id={`${uniqueId}-audio`}
              class="w-12 h-12 bg-black/60 hover:bg-black/80 rounded-full flex items-center justify-center shadow-lg transition-all duration-300 backdrop-blur-sm border border-white/20"
              aria-label="Alternar audio" 
              title="Cambiar estado del audio"
            >
              <span id={`${uniqueId}-mute-icon`} class="text-white">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polygon points="11,5 6,9 2,9 2,15 6,15 11,19 11,5"></polygon>
                  <line x1="23" y1="9" x2="17" y2="15"></line>
                  <line x1="17" y1="9" x2="23" y2="15"></line>
                </svg>
              </span>
              <span id={`${uniqueId}-unmute-icon`} class="text-white hidden">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polygon points="11,5 6,9 2,9 2,15 6,15 11,19 11,5"></polygon>
                  <path d="m19.07 4.93-10 10"></path>
                  <path d="m21.44 12-6.84-6.84"></path>
                </svg>
              </span>
            </button>
          </div>
        </div>
      </div>

      <!-- Resto del contenido igual... -->
           <!-- Texto -->
      <div class="w-full lg:w-1/2 order-2 lg:order-1">
        <div class="space-y-8">
          <!-- Evento 1 -->
          <div class="flex gap-4">
            <div class="flex-shrink-0">
              <span
                class="inline-flex items-center justify-center w-8 h-8 text-sm font-bold text-gray-600 bg-gray-100 rounded-full"
                >01</span
              >
            </div>
            <div class="flex-1">
              <h3 class="text-xl font-bold text-gray-900 mb-2">Eventos UNE</h3>
              <p class="text-gray-600 mb-4">
                Webinars, talleres congresos y todos los eventos
              </p>
              <a
                href="/vidaestudiantil/General"
                class="inline-flex items-center text-sm font-medium text-gray-900 hover:text-blue-600 transition-colors group"
              >
                <span>Conocer todos los eventos</span>
                <svg
                  class="w-4 h-4 ml-2 transition-transform group-hover:translate-x-1"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5l7 7-7 7"></path>
                </svg>
              </a>
              <div class="mt-4 h-px bg-gray-200"></div>
            </div>
          </div>

          <!-- Evento 2 -->
          <div class="flex gap-4">
            <div class="flex-shrink-0">
              <span
                class="inline-flex items-center justify-center w-8 h-8 text-sm font-bold text-gray-600 bg-gray-100 rounded-full"
                >02</span
              >
            </div>
            <div class="flex-1">
              <h3 class="text-xl font-bold text-gray-900 mb-2">
                Egresados Destacados
              </h3>
              <p class="text-gray-600 mb-4">
                Reconocemos con orgullo a nuestros egresados por sus logros
                académicos, profesionales y su impacto en la sociedad.
              </p>
              <a href="/Orgulloune/General"
                class="inline-flex items-center text-sm font-medium text-gray-900 hover:text-blue-600 transition-colors group"
              >
                <span>¡Postúlate o recomienda a un compañero!</span>
                <svg
                  class="w-4 h-4 ml-2 transition-transform group-hover:translate-x-1"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5l7 7-7 7"></path>
                </svg>
              </a>
              <div class="mt-4 h-px bg-gray-200"></div>
            </div>
          </div>

          <!-- Evento 3 -->
          <div class="flex gap-4">
            <div class="flex-shrink-0">
              <span
                class="inline-flex items-center justify-center w-8 h-8 text-sm font-bold text-gray-600 bg-gray-100 rounded-full"
                >03</span
              >
            </div>
            <div class="flex-1">
              <h3 class="text-xl font-bold text-gray-900 mb-2">
                Beneficios estudiantiles
              </h3>
              <p class="text-gray-600 mb-4">
                Talleres prácticos para adolescentes, mentorías con expertos
                para posgrados. Todo en un solo lugar
              </p>
              <a href="acerca/Apoyos"
                class="inline-flex items-center text-sm font-medium text-gray-900 hover:text-blue-600 transition-colors group"
              >
                <span>Conoce todo a lo que tienes acceso como estudiante.</span>
                <svg
                  class="w-4 h-4 ml-2 transition-transform group-hover:translate-x-1"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5l7 7-7 7"></path>
                </svg>
              </a>
              <div class="mt-4 h-px bg-gray-200"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>


<style>
  video {
    -webkit-playsinline: true;
  }

  .aspect-\[4\/3\] {
    aspect-ratio: 4 / 3;
  }
</style>

<script define:vars={{ uniqueId }}>
  function initializeVideoControls() {
    const video = document.getElementById(`${uniqueId}-video`);
    const audioToggle = document.getElementById(`${uniqueId}-audio`);
    const playPauseToggle = document.getElementById(`${uniqueId}-play-pause`);
    const muteIcon = document.getElementById(`${uniqueId}-mute-icon`);
    const unmuteIcon = document.getElementById(`${uniqueId}-unmute-icon`);
    const playIcon = document.getElementById(`${uniqueId}-play-icon`);
    const pauseIcon = document.getElementById(`${uniqueId}-pause-icon`);
    const section = document.getElementById(`${uniqueId}-section`);
    
    if (!video || !audioToggle || !playPauseToggle) {
      return;
    }
    
    let isVideoLoaded = false;
    
    // Función simple para alternar play/pause
    function togglePlayPause() {
      if (video.paused) {
        video.play().then(() => {
          updatePlayPauseButton();
        }).catch(e => {
        });
      } else {
        video.pause();
        updatePlayPauseButton();
      }
    }
    
    // Función para alternar audio
    function toggleAudio() {
      video.muted = !video.muted;
      updateAudioButton();
    }
    
    // Actualizar botón play/pause
    function updatePlayPauseButton() {
      if (video.paused) {
        playIcon?.classList.remove('hidden');
        pauseIcon?.classList.add('hidden');
      } else {
        playIcon?.classList.add('hidden');
        pauseIcon?.classList.remove('hidden');
      }
    }
    
    // Actualizar botón audio
    function updateAudioButton() {
      if (video.muted) {
        muteIcon?.classList.remove('hidden');
        unmuteIcon?.classList.add('hidden');
      } else {
        muteIcon?.classList.add('hidden');
        unmuteIcon?.classList.remove('hidden');
      }
    }
    
    // Cargar video
    function loadVideo() {
      if (isVideoLoaded) return;
      
      const videoSrc = video.getAttribute('data-src');
      if (videoSrc) {
        video.src = videoSrc;
        video.load();
        isVideoLoaded = true;
      }
    }
    
    // Event listeners
    playPauseToggle.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      
      if (!isVideoLoaded) {
        loadVideo();
        setTimeout(() => {
          if (video.readyState >= 2) {
            togglePlayPause();
          }
        }, 500);
      } else {
        togglePlayPause();
      }
    });
    
    audioToggle.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      
      if (!isVideoLoaded) {
        loadVideo();
      }
      toggleAudio();
    });
    
    // Event listeners del video
    video.addEventListener('play', updatePlayPauseButton);
    video.addEventListener('pause', updatePlayPauseButton);
    video.addEventListener('volumechange', updateAudioButton);
    
    // Lazy loading
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting && !isVideoLoaded) {
          loadVideo();
        }
      });
    }, { threshold: 0.1 });
    
    if (section) {
      observer.observe(section);
    }
    
    // Inicializar
    updatePlayPauseButton();
    updateAudioButton();
  }
  
  // Inicializar
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeVideoControls);
  } else {
    setTimeout(initializeVideoControls, 100);
  }
</script>