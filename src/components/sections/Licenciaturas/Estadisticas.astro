---
// PorqueElegirnos.astro
import { CircleArrowRight } from "@lucide/astro";
---

<section class="bg-white py-16 px-6 lg:px-12 stats-section" id="estadisticas-section">
  <div class="max-w-7xl mx-auto">
    <!-- Header -->
  <div class="mb-12">
      <h2 class="text-3xl lg:text-4xl font-bold text-gray-900 mb-4">
        Por qué elegirnos
      </h2>
      <p class="text-gray-600 text-lg max-w-2xl">
        Especialízate con una maestría de excelencia académica y proyección profesional. Profundiza en tu área de expertise, desarrolla investigación de vanguardia y lidera la transformación en tu campo profesional con programas diseñados para profesionales como tú.
      </p>
    </div>
    <!-- Stats Grid - Desktop: 3x2 grid, Mobile: vertical list -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
      
      <!-- Años de experiencia -->
      <div class="relative p-8 border-b border-l border-gray-200 hover:shadow-lg transition-shadow">
        <div class="absolute left-0 top-1/2 transform -translate-y-1/2 w-1 h-16 bg-red-500 rounded-full"></div>
        <div class="ml-6">
          <div class="text-5xl font-bold text-gray-900 mb-2 counter-number" data-target="30">0</div>
          <h3 class="text-xl font-semibold text-gray-900 mb-3">Años de experiencia</h3>
          <button class="flex items-center text-gray-600 hover:text-gray-900 transition-colors">
            <span class="text-sm">Conoce nuestra historia</span>
            <CircleArrowRight class="ml-2 w-4 h-4"/>
          </button>
        </div>
      </div>

      <!-- Empleabilidad -->
      <div class="relative p-8 border-b border-l border-gray-200 hover:shadow-lg transition-shadow">
        <div class="absolute left-0 top-1/2 transform -translate-y-1/2 w-1 h-16 bg-red-500 rounded-full"></div>
        <div class="ml-6">
          <div class="text-5xl font-bold text-gray-900 mb-2">
            <span class="counter-number" data-target="95">0</span>%
          </div>
          <h3 class="text-xl font-semibold text-gray-900 mb-3">de empleabilidad</h3>
          <button class="flex items-center text-gray-600 hover:text-gray-900 transition-colors">
            <span class="text-sm">Ver egresados destacados</span>
            <CircleArrowRight class="ml-2 w-4 h-4"/>
          </button>
        </div>
      </div>

      <!-- Planteles -->
      <div class="relative p-8 border-b md:border-r border-l border-gray-200 hover:shadow-lg transition-shadow">
        <div class="absolute left-0 top-1/2 transform -translate-y-1/2 w-1 h-16 bg-red-500 rounded-full"></div>
        <div class="ml-6">
          <div class="text-5xl font-bold text-gray-900 mb-2 counter-number" data-target="18">0</div>
          <h3 class="text-xl font-semibold text-gray-900 mb-3">Planteles</h3>
          <button class="flex items-center text-gray-600 hover:text-gray-900 transition-colors">
            <span class="text-sm">Conoce los planteles</span>
            <CircleArrowRight class="ml-2 w-4 h-4"/>
          </button>
        </div>
      </div>

      <!-- Carreras -->
      <div class="relative p-8 border-b border-l border-gray-200 hover:shadow-lg transition-shadow">
        <div class="absolute left-0 top-1/2 transform -translate-y-1/2 w-1 h-16 bg-red-500 rounded-full"></div>
        <div class="ml-6">
          <div class="text-5xl font-bold text-gray-900 mb-2 counter-number" data-target="45">0</div>
          <h3 class="text-xl font-semibold text-gray-900 mb-3">Carreras</h3>
          <button class="flex items-center text-gray-600 hover:text-gray-900 transition-colors">
            <span class="text-sm">Descubrir oferta</span>
            <CircleArrowRight class="ml-2 w-4 h-4"/>
          </button>
        </div>
      </div>

      <!-- Modalidades -->
      <div class="relative p-8 border-b border-l border-gray-200 hover:shadow-lg transition-shadow">
        <div class="absolute left-0 top-1/2 transform -translate-y-1/2 w-1 h-16 bg-red-500 rounded-full"></div>
        <div class="ml-6">
          <div class="text-5xl font-bold text-gray-900 mb-2 counter-number" data-target="5">0</div>
          <h3 class="text-xl font-semibold text-gray-900 mb-3">Modalidades</h3>
          <button class="flex items-center text-gray-600 hover:text-gray-900 transition-colors">
            <span class="text-sm">Conoce las modalidades</span>
            <CircleArrowRight class="ml-2 w-4 h-4"/>
          </button>
        </div>
      </div>

      <!-- Talleres -->
      <div class="relative p-8 border-b border-l border-gray-200 hover:shadow-lg transition-shadow">
        <div class="absolute left-0 top-1/2 transform -translate-y-1/2 w-1 h-16 bg-red-500 rounded-full"></div>
        <div class="ml-6">
          <div class="text-5xl font-bold text-gray-900 mb-2 counter-number" data-target="12">0</div>
          <h3 class="text-xl font-semibold text-gray-900 mb-3">Talleres</h3>
          <button class="flex items-center text-gray-600 hover:text-gray-900 transition-colors">
            <span class="text-sm">Explora los talleres</span>
            <CircleArrowRight class="ml-2 w-4 h-4"/>
          </button>
        </div>
      </div>

    </div>
  </div>
</section>

<script is:inline>
  function initCounters() {
    // Función para animar contadores con requestAnimationFrame
    function animateCounter(element, target, duration = 2000) {
      const start = 0;
      const startTime = performance.now();
      
      function updateCounter(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        
        // Usar easing para una animación más suave
        const easeOutCubic = 1 - Math.pow(1 - progress, 3);
        const current = Math.floor(start + (target - start) * easeOutCubic);
        
        element.textContent = current;
        
        if (progress < 1) {
          requestAnimationFrame(updateCounter);
        } else {
          element.textContent = target;
        }
      }
      
      requestAnimationFrame(updateCounter);
    }

    // Intersection Observer con configuración optimizada
    const observerOptions = {
      threshold: 0.3,
      rootMargin: '0px 0px -100px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting && !entry.target.hasAttribute('data-animated')) {
          // Marcar como animado para evitar repeticiones
          entry.target.setAttribute('data-animated', 'true');
          
          const counters = entry.target.querySelectorAll('.counter-number');
          
          counters.forEach((counter, index) => {
            const target = parseInt(counter.getAttribute('data-target'));
            setTimeout(() => {
              animateCounter(counter, target, 2500);
            }, index * 300);
          });
        }
      });
    }, observerOptions);

    // Buscar específicamente la sección de estadísticas
    const statsSection = document.querySelector('#estadisticas-section');
    if (statsSection) {
      observer.observe(statsSection);
    }
  }

  // Ejecutar cuando el DOM esté listo
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCounters);
  } else {
    // Dar un pequeño tiempo para que se renderice completamente
    setTimeout(initCounters, 100);
  }
</script>